<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <link rel="icon" type="image/png" href="/generated-icon.png" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- Browser Console Logger for MCP -->
    <script>
      (function() {
        let ws;
        
        function connectToLogger() {
          try {
            ws = new WebSocket('ws://localhost:8765');
            
            ws.onopen = function() {
              console.log('Connected to MCP console logger');
            };
            
            ws.onclose = function() {
              console.log('Disconnected from MCP console logger');
              // Retry connection after 5 seconds
              setTimeout(connectToLogger, 5000);
            };
            
            ws.onerror = function(error) {
              console.log('MCP logger connection error:', error);
            };
          } catch (error) {
            console.log('Failed to connect to MCP logger:', error);
            setTimeout(connectToLogger, 5000);
          }
        }
        
        function sendToLogger(data) {
          if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify(data));
          }
        }
        
        // Override console methods
        const originalConsole = {
          log: console.log,
          info: console.info,
          warn: console.warn,
          error: console.error,
          debug: console.debug
        };
        
        ['log', 'info', 'warn', 'error', 'debug'].forEach(level => {
          console[level] = function(...args) {
            originalConsole[level].apply(console, args);
            sendToLogger({
              type: 'console',
              level: level,
              message: args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' '),
              url: window.location.href,
              line: null,
              column: null
            });
          };
        });
        
        // Capture network requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
          const startTime = Date.now();
          const url = args[0];
          const options = args[1] || {};
          const method = options.method || 'GET';
          
          return originalFetch.apply(this, args).then(response => {
            const endTime = Date.now();
            sendToLogger({
              type: 'network',
              method: method,
              url: url,
              status: response.status,
              statusText: response.statusText,
              responseTime: endTime - startTime
            });
            return response;
          }).catch(error => {
            const endTime = Date.now();
            sendToLogger({
              type: 'network',
              method: method,
              url: url,
              status: 0,
              statusText: 'Network Error',
              responseTime: endTime - startTime
            });
            throw error;
          });
        };
        
        // Capture XMLHttpRequest
        const originalXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
          const xhr = new originalXHR();
          const originalOpen = xhr.open;
          const originalSend = xhr.send;
          let method, url, startTime;
          
          xhr.open = function(m, u, ...args) {
            method = m;
            url = u;
            return originalOpen.apply(this, [m, u, ...args]);
          };
          
          xhr.send = function(...args) {
            startTime = Date.now();
            
            xhr.addEventListener('loadend', function() {
              const endTime = Date.now();
              sendToLogger({
                type: 'network',
                method: method,
                url: url,
                status: xhr.status,
                statusText: xhr.statusText,
                responseTime: endTime - startTime
              });
            });
            
            return originalSend.apply(this, args);
          };
          
          return xhr;
        };
        
        // Start connection
        connectToLogger();
      })();
    </script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>